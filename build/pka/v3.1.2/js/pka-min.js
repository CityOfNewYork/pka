/*

pka-min-v3.1.2

*/
var nyc=nyc||{};nyc.fieldAccess={getCoordinates:function(){return this.getGeometry().getCoordinates()},getName:function(){return this.get("NAME")}};var nyc=nyc||{};nyc.Style=function(){this.locationCache={}};
nyc.Style.prototype={locationCache:null,imgExt:function(){return nyc.util.isIe()||nyc.util.isIos()?".png":".svg"},zoom:function(resolution){return nyc.ol.TILE_GRID.getZForResolution(resolution)-8},location:function(feature,resolution){var zoom=this.zoom(resolution),isFeature=feature.get("isFeature");this.locationCache[zoom]=this.locationCache[zoom]||{};if(!this.locationCache[zoom][isFeature])if(isFeature&&zoom>3)this.locationCache[zoom][isFeature]=new ol.style.Style({image:new ol.style.Circle({radius:3.2*
zoom,stroke:new ol.style.Stroke({color:"rgba(1,51,100,1)",width:5})})});else this.locationCache[zoom][isFeature]=new ol.style.Style({image:new ol.style.Icon({scale:48/512,src:"img/me"+this.imgExt()})});return this.locationCache[zoom][isFeature]}};var pka=pka||{};pka.ApplicationPeriod=function(startDate,endDate){this.applyStart=this.localeDate(startDate);this.applyEnd=this.localeDate(endDate)};
pka.ApplicationPeriod.prototype={applyStart:null,applyEnd:null,isActive:function(){var today=new Date;return today>=this.applyStart&&today<this.applyEnd},localeDate:function(dateString){if(window.IE8)return this.ie8Date(dateString);var utcDate=dateString?new Date(dateString):new Date;return new Date(utcDate.getTime()+utcDate.getTimezoneOffset()*6E4)},ie8Date:function(dateString){return dateString?new Date(unIso(dateString)):new Date},unIso:function(dateString){if(typeof dateString!="string")return dateString;
var dateParts=dateString.split("-");return dateParts[1]+"/"+dateParts[2]+"/"+dateParts[0]}};var pka=pka||{};
pka.Form=function(applicationPeriod,content,languages){this.englishOnly=/^(?=.*[A-Z0-9])[\w.,!"'-@\/$ ]+$/i;this.content=content;this.languages=languages;this.dob=new nyc.DateField("#student-dob","studentDob",content.message("min_dob_year"),content.message("max_dob_year"));this.dialog=new nyc.Dialog;$("#birth-year").val(content.message("birth_year"));$("#start-year").val(content.message("start_year"));$("#form-note").html(content.message(applicationPeriod.isActive()?"form_msg_yes_apply":"form_msg_no_apply"));
$("#student-dob-note").html(content.message("form_dob_msg"));$("#form-submit").click($.proxy(this.valid,this));$("#review-submit").click($.proxy(this.post,this));$("#form-page select").on("change",function(e){var target=e.target,inputs=$("#form-page form").find(":input");$(target).blur();if(target.id=="language")$("#form-submit").focus(10);else inputs.eq(inputs.index(target)+1).focus(10)});for(var code in languages){var opt=$('\x3coption class\x3d"notranslate" translate\x3d"no"\x3e\x3c/option\x3e');
opt.data("code",code);opt.attr("value",languages[code].val);opt.html(languages[code].desc);$("#language").append(opt)}$("#language").change(function(){var val=$("#language").val();$("#language-code").val("en");for(var code in languages)if(val==languages[code].val){$("#language-code").val(code);break}})};
pka.Form.prototype={applicationPeriod:null,content:null,dob:null,submitting:false,reset:function(){$("#form-page form").get(0).reset();$("#language").selectmenu().val(this.languages[nyc.lang.lang()||"en"].val).selectmenu("refresh")},valid:function(){var err=[],englishOnly=this.englishOnly;$("#form-page label, #form-page span").removeClass("err");if(!this.dob.val()){err.push(this.dob.selectMonth[0]);$('label[for\x3d"student-dob"]').addClass("err")}$.each($("#form-page input, #form-page select"),function(_,
n){var val=$(n).val(),pattern=$(n).attr("pattern")||$(n).data("pattern"),valid=true;if($(n).prop("required")||$(n).attr("required"))valid=val.length;if(valid&&val.length)valid=englishOnly.test(val);if(valid&&pattern)valid=(new RegExp(pattern)).test(val);if(!valid&&!$(n).prop("required")&&$(n).attr("required")&&!val.length)valid=true;if(!valid){err.push(n);$('label[for\x3d"'+n.id+'"]').addClass("err")}});if(err.length){$(err[0]).focus();this.dialog.ok({message:this.content.message("form_invalid")})}else this.review();
return false},again:function(yes,noreset){if(!yes)$("body").pagecontainer("change","#map-page",{transition:"slideup"});else if(!noreset){this.dob.reset();$($(".child input").val("").get(0)).focus()}},retry:function(){this.again(true,true)},review:function(){var data=this.formData();for(var d in data)$("#review-"+d).html(data[d].toString());$("#form-review").fadeIn();if($("#form-review").height()>320)$("#review-submit").focus(200)},formData:function(){var result={};$.each($("#form-page form").serializeArray(),
function(_,input){result[input.name]=input.value||""});return result},post:function(){var me=this;$("#form-processing").fadeIn(function(){$("#form-review").fadeOut()});$.ajax({url:"/pka-form/",data:this.formData(),type:"POST",success:function(){$("#form-processing").fadeOut(function(){me.dialog.yesNo({message:me.content.message("form_another"),callback:$.proxy(me.again,me)})})},error:function(){$("#form-processing").fadeOut(function(){me.dialog.ok({message:me.content.message("form_error"),callback:$.proxy(me.retry,
me)})})}})}};var pka=pka||{};
pka.Splash=function(applicationPeriod,lookup,content,app){$(".splash-call").html(content.message("btn_call"));if(applicationPeriod.isActive()){$(".splash-msg").html(content.message("splash_msg_yes_apply"));$(".splash-apply").html(content.message("btn_apply")).attr("href",lookup.apply_url)}else{$(".splash-msg").html(content.message("splash_msg_no_apply"));$(".splash-apply").hide()}$("button.splash-map").click($.proxy(app.checkEntryButton,app));$(".splash-call, .splash-map").click($.proxy(app.page,app))};var pka=pka||{};pka.Style=function(){this.schoolCache={};this.districtCache={}};
pka.Style.prototype={schoolCache:null,districtCache:null,school:function(feature,resolution){var zoom=this.zoom(resolution),type=feature.getType(),prek3k=feature.get("3K_SEATS")>0?"3k":"prek",radius=[8,8,16,16,16,24,24,32,32,48,48][zoom],image="img/"+type+this.imgExt();this.schoolCache[zoom]=this.schoolCache[zoom]||{};this.schoolCache[zoom][type]=this.schoolCache[zoom][type]||{};if(!this.schoolCache[zoom][type][prek3k]){this.schoolCache[zoom][type][prek3k]=new ol.style.Style({image:new ol.style.Icon({scale:radius/
54,src:image})});if(prek3k=="3k"){var size=zoom>8?20:12;this.schoolCache[zoom][type][prek3k].setText(new ol.style.Text({text:"3K",fill:new ol.style.Fill({color:"rgb(1,51,100)"}),stroke:new ol.style.Stroke({color:"#fff",width:size==20?4:2}),font:"bold "+size+'px "Helvetica Neue", Helvetica, Arial, sans-serif',offsetX:size==20?-3:-1,offsetY:size==20?10:6}))}}return this.schoolCache[zoom][type][prek3k]},district:function(feature,resolution){var zoom=this.zoom(resolution),width=[2,2,2,3,3,5,5,8,8,12,
16,18,20,22][zoom],geom=feature.getGeometry(),uid=JSON.stringify(geom.getCoordinates()),dist=feature.get("NAME")+"";this.districtCache[zoom]=this.districtCache[zoom]||{};if(!this.districtCache[zoom][uid]){var options={stroke:new ol.style.Stroke({color:"#808080",width:width})};if(geom.getArea()>6712642){var size=[8,10,12,16,24,32,32,48,64,72,96][zoom];options.text=new ol.style.Text({font:"bold "+size+"px helvetica",text:dist,fill:new ol.style.Fill({color:"#000"})})}this.districtCache[zoom][uid]=new ol.style.Style(options)}return this.districtCache[zoom][uid]}};
nyc.inherits(pka.Style,nyc.Style);var pka=pka||{};
pka.lookup={apply_url:"https://prod.semsnycdoe.com/parentsite/",full_day:[1,2,5,7],day_length:{0:"Day length not available",1:"Full day",2:"Full day and Half Day",3:"Half Day",4:"5-Hour",5:"Full Day and 5-Hour",6:"Half Day and 5-hour",7:"Full Day, Half Day and 5-hour"},indoor_outdoor:{1:"Indoor playspace",2:"Indoor/Outdoor (offsite) playspace",3:"Indoor/Outdoor (onsite) playspace",4:"Indoor/Outdoor (onsite) playspace/Outdoor (offsite) playspace",5:"Playspace not offered",6:"Outdoor (offsite) playspace",7:"Outdoor (onsite) playspace",
8:"Outdoor (onsite) playspace/Outdoor (offsite) playspace",9:"Please contact site directly for information about playspace"},meals:{1:"Breakfast",2:"Breakfast/Lunch",3:"Breakfast/Lunch/Snack(s)",4:"Breakfast/Snack(s)",5:"Please contact site directly for information about meals",6:"Lunch",7:"Lunch/Snack(s)",8:"Snack(s)"},dual_lang:{100:"Arabic",101:"Bengali",102:"Chinese",103:"Chinese (Mandarin)",104:"Chinese (Cantonese)",105:"French",106:"Haitian-Creole",107:"Korean",108:"Russian",109:"Spanish",110:"Urdu",
111:"Hindi",112:"Gujarati",113:"Hebrew",114:"Polish",115:"Japanese",116:"Italian",117:"Yiddish",118:"Portuguese",119:"Tagalog",120:"Greek",121:"German",122:"Farsi",123:"Vietnamese"},enhanced_lang:{200:"Arabic",201:"Bengali",202:"Chinese",203:"Chinese (Mandarin)",204:"Chinese (Cantonese)",205:"French",206:"Haitian-Creole",207:"Korean",208:"Russian",209:"Spanish",210:"Urdu",211:"Hindi",212:"Gujarati",213:"Hebrew",214:"Polish",215:"Japanese",216:"Italian",217:"Yiddish",218:"Portuguese",219:"Tagalog",
220:"Greek",221:"German",222:"Farsi",223:"Vietnamese"},borough:{"M":"Manhattan","X":"Bronx","K":"Brooklyn","Q":"Queens","R":"Staten Island"},languages:{en:{val:"English",desc:"English",hint:"Translate"},ar:{val:"Arabic",desc:"\x26#x627;\x26#x644;\x26#x639;\x26#x631;\x26#x628;\x26#x64A;\x26#x629;",hint:"\x26#x62A;\x26#x631;\x26#x62C;\x26#x645;"},bn:{val:"Bengali",desc:"\x26#x9AC;\x26#x9BE;\x26#x999;\x26#x9BE;\x26#x9B2;\x26#x9BF;",hint:"\x26#x985;\x26#x9A8;\x26#x9C1;\x26#x9AC;\x26#x9BE;\x26#x9A6; \x26#x995;\x26#x9B0;\x26#x9BE;"},
"zh-CN":{val:"Chinese (Simplified)",desc:"\x26#x4E2D;\x26#x56FD;",hint:"\x26#x7FFB;\x26#x8BD1;"},fr:{val:"French",desc:"Fran\x26#231;ais",hint:"Traduire"},ht:{val:"Haitian Creole",desc:"Krey\x26#242;l Ayisyen",hint:"Tradui"},ko:{val:"Korean",desc:"\x26#xD55C;\x26#xAD6D;\x26#xC758;",hint:"\x26#xBC88;\x26#xC5ED;"},ru:{val:"Russian",desc:"P\x26#x443;\x26#x441;\x26#x441;\x26#x43A;\x26#x438;\x26#x439;",hint:"\x26#x43F;\x26#x435;\x26#x440;\x26#x435;\x26#x432;\x26#x435;\x26#x441;\x26#x442;\x26#x438;"},es:{val:"Spanish",
desc:"Espa\x26#241;ol",hint:"Traducir"},ur:{val:"Urdu",desc:"\x26#x627;\x26#x631;\x26#x62F;\x26#x648;",hint:"\x26#x62A;\x26#x631;\x26#x62C;\x26#x645;\x26#x6C1; \x26#x6A9;\x26#x631;\x26#x6CC;\x26#x6BA;"}}};var pka=pka||{};
pka.messages=[{flex_sched:"Program may utilize flexible scheduling policy. Please contact program directly for details about pre-K schedule.",sped_flg:"If your child has an IEP recommending Related Services and/or SEIT, contact the program directly for more information before applying.",income_flg:"Program may have income or other eligibility requirements. Contact for more information.",start_time:"Daily Start Time: ${start_time}",early_drop_off:"Early Drop Off Available: ${early_drop}",late_pick_up:"Late Pick Up Available: ${late_pickup}",
search_label:'\x3cimg src\x3d"img/${TYPE}.png" alt\x3d"${TYPE}"\x3e\x3cspan class\x3d"srch-loccode"\x3e${LOCCODE}\x3c/span\x3e${NAME}',hotline_call_now:"call now",yes:"Yes",no:"No",contact_start:"Contact program about start time",contact_extend:"Contact program about extended hours"},{info:'\x3cdiv id\x3d"${infoId}" class\x3d"${infoClass} info"\x3e\x3c/div\x3e',info_container:'\x3cdiv class\x3d"inf-container"\x3e\x3c/div\x3e',info_name:'\x3cdiv class\x3d"inf-name notranslate" translate\x3d"no"\x3e\x3cimg alt\x3d"" src\x3d"img/${TYPE}.png"\x3e${NAME}\x3c/div\x3e',
info_distance:'\x3cdiv class\x3d"inf-dist notranslate" translate\x3d"no"\x3e\x26bull; ${distance} mi \x26bull;\x3c/div\x3e',info_code:'\x3cdiv class\x3d"code"\x3e\x3cspan class\x3d"inf-name"\x3eProgram Code: ${LOCCODE}\x3c/span\x3e\x3c/div\x3e',info_address:'\x3cdiv class\x3d"notranslate" translate\x3d"no"\x3e${address_1}\x3c/div\x3e\x3cdiv class\x3d"notranslate" translate\x3d"no"\x3e${address_2}\x3c/div\x3e',info_apply_btn:'\x3cdiv class\x3d"capitalize inf-btn apply"\x3e\x3ca data-role\x3d"button" href\x3d"${apply_url}" target\x3d"_blank" rel\x3d"noopener noreferer"\x3e${btn_apply}\x3c/a\x3e\x3c/div\x3e',
info_pdf_btn:'\x3cdiv class\x3d"capitalize inf-btn pdf"\x3e\x3ca data-role\x3d"button" href\x3d"${pdf_url}" target\x3d"_blank" rel\x3d"noopener noreferer"\x3e${btn_pdf}\x3c/a\x3e\x3c/div\x3e',info_contact:'\x3cdiv class\x3d"capitalize inf-btn contact"\x3e\x3c/div\x3e',info_phone:'\x3cdiv class\x3d"phone notranslate" translate\x3d"no"\x3e\x3ca data-role\x3d"button" href\x3d"tel:${phone}"\x3e${PHONE}\x3c/a\x3e\x3c/div\x3e',info_vcard:'\x3cdiv class\x3d"vcard"\x3e\x3ca data-role\x3d"button" onclick\x3d"nyc.app.schoolVcard(\'${fid}\');"\x3econtact\x3c/a\x3e\x3c/div\x3e',
info_detail:'\x3cdiv class\x3d"inf-detail"\x3e\x3c/div\x3e',info_email:'\x3cdiv class\x3d"email" translate\x3d"no"\x3e\x3ca data-role\x3d"button" href\x3d"mailto:${EMAIL}"\x3eemail\x3c/a\x3e\x3c/div\x3e',info_email_lnk:'\x3cdiv class\x3d"email-lnk" translate\x3d"no"\x3e\x3ca href\x3d"mailto:${EMAIL}"\x3e${EMAIL}\x3c/a\x3e\x3c/div\x3e',info_web:'\x3cdiv class\x3d"web" translate\x3d"no"\x3e\x3ca data-role\x3d"button" href\x3d"${WEBSITE}" target\x3d"_blank" rel\x3d"noopener noreferer"\x3ewebsite\x3c/a\x3e\x3c/div\x3e',
info_note:'\x3cdiv class\x3d"note"\x3e${NOTE}\x3c/div\x3e',info_program_features:'\x3cdiv class\x3d"inf-name"\x3eProgram Features:\x3c/div\x3e\x3cul class\x3d"feats"\x3e\x3cli\x3e${meals}\x3c/li\x3e\x3cli\x3e${in_out}\x3c/li\x3e\x3cli\x3e${start}\x3c/li\x3e\x3cli\x3e${early}\x3c/li\x3e\x3cli\x3e${late}\x3c/li\x3e\x3c/ul\x3e',info_seats:'\x3cdiv class\x3d"seats"\x3e\x3cspan class\x3d"inf-name"\x3e${school_year} Seats:\x3c/span\x3e\x3c/div\x3e',info_el_seats:'\x3cli class\x3d"seats"\x3e\x3cspan class\x3d"inf-name"\x3eEarly Learn 3s: \x3c/span\x3e${EL_SEATS} Full day\x3c/li\x3e',
info_3k_seats:'\x3cli class\x3d"seats"\x3e\x3cspan class\x3d"inf-name"\x3e3-K: \x3c/span\x3e${3K_SEATS} Full day\x3c/li\x3e',info_prek_seats:'\x3cli class\x3d"seats"\x3e\x3cspan class\x3d"inf-name"\x3ePre-K: \x3c/span\x3e${PREK_SEATS} ${day_length}\x3c/li\x3e',info_dual_lang:"\x3cdiv\x3e\x3cb\x3eDual Language:\x3c/b\x3e ${lang}\x3c/div\x3e",info_enhanced_lang:"\x3cdiv\x3e\x3cb\x3eEnhanced Language Support:\x3c/b\x3e ${lang}\x3c/div\x3e",info_flex:"\x3cdiv\x3e\x3cb\x3eAlert:\x3c/b\x3e ${flex}\x3c/div\x3e",
info_sped:"\x3cdiv\x3e\x3cb\x3eAlert:\x3c/b\x3e ${sped}\x3c/div\x3e",info_special:"\x3cdiv\x3e${SPECIAL_PRIOR}\x3c/div\x3e",info_income:"\x3cdiv\x3e${income}\x3c/div\x3e",info_action:'\x3cdiv class\x3d"capitalize inf-btn action"\x3e\x3c/div\x3e',info_directions_btn:'\x3cdiv class\x3d"directions"\x3e\x3ca data-role\x3d"button" onclick\x3d"nyc.app.direct(\'${fid}\');"\x3edirect\x3c/a\x3e\x3c/div\x3e',info_map_btn:'\x3cdiv class\x3d"map"\x3e\x3ca data-role\x3d"button" onclick\x3d"nyc.app.goToSchool(\'${fid}\');"\x3emap\x3c/a\x3e\x3c/div\x3e',
info_detail_btn:'\x3cdiv class\x3d"detail"\x3e\x3ca data-role\x3d"button" onclick\x3d"nyc.app.schoolDetail(\'${infoId}\');"\x3edetail\x3c/a\x3e\x3c/div\x3e'},{vcard_code:"\nProgram Code: ${LOCCODE}\n\n",vcard_note:"${NOTE}\n\n",vcard_program_features:"Program Features:\n\n\t${meals}\n\t${in_out}\n\t${start}\n\t${early}\n\t${late}\n\n",vcard_seats:"${school_year} Pre-K Seats: ${PREK_SEATS} ${day_length}\n\n",vcard_dual_lang:"Dual Language: ${lang}\n\n",vcard_enhanced_lang:"Enhanced Language Support: ${lang}\n\n",
vcard_flex:"Alert: ${flex}\n\n",vcard_sped:"Alert: ${sped}\n\n",vcard_special:"${SPECIAL_PRIOR}\n\n",vcard_income:"${income}\n\n",vcard_link:"\n\nhttp://maps.nyc.gov/pka/?fid\x3d${fid}#map-page"}];var pka=pka||{};
pka.fieldAccess={jcardBuilder:new nyc.jcard.Builder,extendFeature:function(){var props=this.getProperties();this.setId(this.getId());props.fid=this.getId();if(props["EL_SEATS"]>0&&!props["3K_SEATS"]&&!props.PREK_SEATS)props.prek3="el";else if(props["EL_SEATS"]>0&&props["3K_SEATS"]>0&&!props.PREK_SEATS)props.prek3="el-3k";else if(props["EL_SEATS"]>0&&props["3K_SEATS"]>0&&props.PREK_SEATS>0)props.prek3="el-3k-pk";else if(props["EL_SEATS"]>0&&!props["3K_SEATS"]&&props.PREK_SEATS>0)props.prek3="el-pk";
else if(!props["EL_SEATS"]&&props["3K_SEATS"]>0&&!props.PREK_SEATS)props.prek3="3k";else if(!props["EL_SEATS"]&&!props["3K_SEATS"]&&props.PREK_SEATS>0)props.prek3="pk";else if(!props["EL_SEATS"]&&props["3K_SEATS"]>0&&props.PREK_SEATS>0)props.prek3="3k-pk";props.loccode4=props.fid.substr(props.fid.length-4);props.address_1=props.ADDRESS;props.city=this.borough[props.BOROUGH];props.address_2=props.city+", NY "+props.ZIP;props.address=props.address_1+", "+props.address_2;props.phone=encodeURIComponent(props.PHONE);
props.meals=this.meals[props.MEALS];props.in_out=this.indoor_outdoor[props.INDOOR_OUTDOOR];props.flex=props.FLEX_SCHED=="1"?this.message("flex_sched"):"";props.sped=props.SPED_FLG=="1"?this.message("sped_flg"):"";props.income=props.INCOME_FLG=="1"?this.message("income_flg"):"";props.lang=props.ENHANCED_LANG!="0"?"1":"";props.start_time=props.START_TIME?props.START_TIME:this.message("contact_start");props.start=this.message("start_time",props);if(props.EARLY_DROP=="1")props.early_drop=this.message("yes");
else if(props.EARLY_DROP=="0")props.early_drop=this.message("no");else props.early_drop=this.message("contact_extend");props.early=this.message("early_drop_off",props);if(props.LATE_PICKUP=="1")props.late_pickup=this.message("yes");else if(props.LATE_PICKUP=="0")props.late_pickup=this.message("no");else props.late_pickup=this.message("contact_extend");props.late=this.message("late_pick_up",props);props.extend=props.EARLY_DROP=="1"||props.LATE_PICKUP=="1"?"1":"";props.school_year=this.message("school_year");
props.day_length=this.day_length[props.DAY_LENGTH];props.full_day=$.inArray(props.DAY_LENGTH*1,this.full_day)>-1;props.apply_url=this.apply_url;props.can_apply=this.applicationPeriod.isActive()&&props.BUTTON_TYPE.toLowerCase()=="apply"?"1":"";props.btn_apply=this.message("btn_apply");props.search_label=this.message("search_label",props);props.btn_pdf=this.message("btn_pdf");props.pdf_url=this.message("quality_pdf",props);this.setProperties(props)},getId:function(){return this.get("LOCCODE")},getType:function(){return this.get("TYPE")},
getDistance:function(){return this.get("distance")},setDistance:function(distance){this.set("distance",distance)},getLangContent:function(infoOrVcard){var me=this,langs=this.getLangs(),dual=langs.dual,enhanced=langs.enhanced,msg="";$.each(dual,function(_,lang){msg+=me.message(infoOrVcard+"_dual_lang",{lang:lang})});$.each(enhanced,function(_,lang){msg+=me.message(infoOrVcard+"_enhanced_lang",{lang:lang})});return msg},getJcardJson:function(){var props=this.getProperties(),builder=this.jcardBuilder,
coordinates=proj4("EPSG:3857","EPSG:4326",this.getCoordinates());builder.add(builder.organization({name:props.NAME}));builder.add(builder.address({type:"work",line1:props.address_1,city:props.city,state:"NY",zip:props.ZIP,country:"U.S.A."}));builder.add(builder.email({type:"work",email:props.EMAIL}));builder.add(builder.parsePhone(props.PHONE));builder.add(builder.url({type:"work",url:props.WEBSITE}));builder.add(builder.timezone("-5:00"));builder.add(builder.geography({lng:coordinates[0],lat:coordinates[1]}));
builder.add(builder.note(this.getJcardNote()));return builder.json()},getLangs:function(){var me=this,codes=this.get("ENHANCED_LANG")||"",langs={dual:[],enhanced:[]};$.each(codes.trim().split(";"),function(_,code){var dual=me.dual_lang[code],enhanced=me.enhanced_lang[code];if(dual)langs.dual.push(dual);if(enhanced)langs.enhanced.push(enhanced)});return langs},getJcardNote:function(){var props=this.getProperties(),langs=this.getLangs(),note=this.message("vcard_code",props);if(props.NOTE)note+=this.message("vcard_note",
props);note+=this.message("vcard_program_features",props);note+=this.message("vcard_seats",props);note+=this.getLangContent("vcard");if(props.flex)note+=this.message("vcard_flex",props);if(props.sped)note+=this.message("vcard_sped",props);if(props.income)note+=this.message("vcard_income",props);note+=this.message("vcard_link",props);return note}};var pka=pka||{};
pka.htmlRenderer={html:function(infoClass){var props=this.getProperties(),infoId=infoClass+this.getId();props.infoId=infoId;props.infoClass=infoClass;return $(this.message("info",props)).append($(this.message("info_container",props)).append(this.distanceHtml()).append(this.message("info_name",props)).append(this.noteHtml(props)).append(this.message("info_address",props)).append(this.pdfBtnHtml(props)).append(this.applyBtnHtml(props)).append(this.phoneWebHtml(props)).append(this.detailHtml(props)).append(this.actionHtml(props)))},distanceHtml:function(){var dist=
this.getDistance();return dist===undefined?"":this.message("info_distance",{distance:(dist/5280).toFixed(2)})},noteHtml:function(props){return props.NOTE?this.message("info_note",props):""},phoneWebHtml:function(props){var web=this.webHtml(props),phone=$(this.message("info_phone",props));if(!web)phone.addClass("full-width");return $(this.message("info_contact")).append(phone).append(web)},contactHtml:function(props){return $(this.message("info_contact")).append(this.message("info_email",props)).append(this.message("info_vcard",
props))},webHtml:function(props){return props.WEBSITE?this.message("info_web",props):""},flexHtml:function(props){return props.flex?this.message("info_flex",props):""},spedHtml:function(props){return props.sped?this.message("info_sped",props):""},specialHtml:function(props){return props.SPECIAL_PRIOR?this.message("info_special",props):""},incomeHtml:function(props){return props.income?this.message("info_income",props):""},detailHtml:function(props){var detailHtml=$(this.message("info_detail"));return detailHtml.append(this.message("info_code",
props)).append(this.message("info_email_lnk",props)).append(this.message("info_program_features",props)).append(this.flexHtml(props)).append(this.spedHtml(props)).append(this.specialHtml(props)).append(this.incomeHtml(props)).append(this.getLangContent("info")).append(this.seatsHtml(props)).append(this.contactHtml(props))},seatsHtml:function(props){var seats=this.get("EL_SEATS")>0?this.message("info_el_seats",props):"";seats+=this.get("3K_SEATS")>0?this.message("info_3k_seats",props):"";seats+=this.get("PREK_SEATS")>
0?this.message("info_prek_seats",props):"";return this.message("info_seats",props)+"\x3cul\x3e"+seats+"\x3c/ul\x3e"},pdfBtnHtml:function(props){return $(this.message("info_pdf_btn",props))},applyBtnHtml:function(props){return props.can_apply?$(this.message("info_apply_btn",props)):""},actionHtml:function(props){var apply=props.can_apply;return $(this.message("info_action")).append(this.message("info_map_btn",props)).append(this.message("info_directions_btn",props)).append(this.message("info_detail_btn",
props))}};var ta=ta||{};ta.Style=function(lookup){this.lookup=lookup;this.stationCache={};this.lineCache={}};
ta.Style.prototype={lookup:null,stationCache:null,lineCache:null,line:function(feature,resolution){var zoom=this.zoom(resolution),line=feature.get("RT_SYMBOL"),width=[1,1,1,1,1,2,4,6,7,8,9,10,11,12][zoom];this.lineCache[zoom]=this.lineCache[zoom]||{};if(!this.lineCache[zoom][line])this.lineCache[zoom][line]=new ol.style.Style({stroke:new ol.style.Stroke({color:this.lookup.color[line],width:width})});return this.lineCache[zoom][line]},station:function(feature,resolution){var zoom=this.zoom(resolution),
radius=[2,2,4,4,4,6,8,10,12,16,24][zoom-4];if(!this.stationCache[zoom])this.stationCache[zoom]=new ol.style.Style({image:new ol.style.Circle({radius:radius,stroke:new ol.style.Stroke({color:"#000",width:radius>2?2:1}),fill:new ol.style.Fill({color:"rgba(255,255,255,0.9)"})})});return this.stationCache[zoom]}};nyc.inherits(ta.Style,nyc.Style);var ta=ta||{};ta.lookup={color:{1:"#ff3433",2:"#ff3433",3:"#ff3433",4:"#009d33",5:"#009d33",6:"#009d33",7:"#c801cc",A:"#0e689a",C:"#0e689a",E:"#0e689a",B:"#fa9705",D:"#fa9705",F:"#fa9705",G:"#98cd01",J:"#9d6400",M:"#9d6400",Z:"#9d6400",L:"#999999",S:"#999999",N:"#ffff0c",R:"#ffff0c",Q:"#ffff0c"}};var ta=ta||{};ta.messages={info:'\x3cdiv class\x3d"subway-info"\x3e\x3cdiv class\x3d"inf-name notranslate" translate\x3d"no"\x3e${NAME}\x3c/div\x3e\x3cdiv class\x3d"icons notranslate" translate\x3d"no""\x3e\x3c/div\x3e\x3cdiv class\x3d"note"\x3e${NOTE}\x3c/div\x3e\x3c/div\x3e',icon:'\x3cdiv class\x3d"subway-icon subway-${line} ${express}"\x3e\x3cdiv\x3e${line}\x3c/div\x3e\x3c/div\x3e'};var ta=ta||{};ta.fieldAccess={extendFeature:function(){var props=this.getProperties();props.lines=this.getLines();this.setProperties(props)},getLines:function(){var lines=[];$.each(this.get("LINE").split("-"),function(_,name){var parts=name.split(" ");lines.push({line:parts[0],express:parts.length==2?"express":""})});return lines}};var ta=ta||{};ta.htmlRenderer={html:function(){var props=this.getProperties();return this.icons($(this.message("info",props)),props.lines)},icons:function(html,lines){var me=this,icons=html.find(".icons");$.each(lines,function(_,line){icons.append(me.message("icon",line))});return html}};var nyc=nyc||{};
nyc.App=function(applicationPeriod,map,layers,filterControls,lookup,content,locationMgr,directions,popup,form){var me=this;me.applicationPeriod=applicationPeriod;me.map=map;me.view=map.getView();me.schoolLyr=layers.school;me.schoolSrc=me.schoolLyr.getSource();me.districtLyr=layers.district;me.subwayStationLyr=layers.subwayStation;me.subwayLineLyr=layers.subwayLine;me.filterControls=filterControls;me.lookup=lookup;me.content=content;me.locationMgr=locationMgr;me.directions=directions;me.popup=popup;
me.form=form;me.pager=new nyc.ListPager;me.controls=locationMgr.controls;new nyc.ol.FeatureTip(me.map,[{layer:me.schoolLyr,labelFunction:me.getTip}]);me.filterDisplay(applicationPeriod);$(map.getTarget()).on("tap click",$.proxy(me.tap,me));me.view.on("change:resolution",$.proxy(me.zoomChange,me));me.schoolSrc.once(nyc.ol.source.Decorating.LoaderEventType.FEATURESLOADED,$.proxy(me.ready,me));$.each(filterControls,function(_,control){control.on("change",$.proxy(me.filter,me))});locationMgr.on(nyc.Locate.EventType.GEOCODE,
$.proxy(me.located,me));locationMgr.on(nyc.Locate.EventType.GEOLOCATION,$.proxy(me.located,me));$("#btn-more a").click($.proxy(me.listNextPage,me));$(".school-yr").html(content.message("school_year"));$("#tabs a").click($.proxy(me.tabs,me));$("body").pagecontainer({change:$.proxy(me.pageChanged,me)});$("#panel, .banner").mouseenter(me.hideTips);$("#map").append($("#btn-call"));$("#btn-call").click($.proxy(me.hotline,me));me.checkEntryUrl();$(window).resize($.proxy(me.resize,me))};
nyc.App.prototype={applicationPeriod:null,map:null,view:null,schoolLyr:null,schoolSrc:null,districtLyr:null,subwayStationLyr:null,subwayLineLyr:null,filterControls:null,content:null,directions:null,popup:null,pager:null,location:null,mapLoaded:false,hotlineDiag:null,schoolVcard:function(fid){var feature=this.schoolSrc.getFeatureById(fid);window.open("/vcard/?"+$.param({jcard:feature.getJcardJson()}))},hotline:function(){var me=this,apply=me.applicationPeriod.isActive();if(!me.hotlineDiag){var dialog=
new nyc.Dialog;dialog.container.find(".dia-btns a").addClass("capitalize hotline");me.hotlineDiag=dialog}me.hotlineDiag.yesNoCancel({message:me.content.message("hotline_msg"),buttonText:[me.content.message("hotline_call_now"),me.content.message(apply?"btn_apply":"btn_call")],buttonHref:["tel:"+encodeURIComponent(me.content.message("hotline_number")),apply?me.lookup.apply_url:"#form-page"]});$('a[href\x3d"'+me.lookup.apply_url+'"]').attr("target","_blank")},goToSchool:function(fid){if($("#inf-full-screen").css("display")==
"block")$("#inf-full-screen").fadeOut();else if(fid){var me=this,feature=me.schoolSrc.getFeatureById(fid);if(feature){var coordinates=feature.getCoordinates();me.map.once("moveend",function(){me.showPopup(feature.getCoordinates(),feature.html("inf-pop"),fid)});if($("#panel").width()==$(window).width())$("#map-tab-btn a").trigger("click");me.view.animate({zoom:me.locationMgr.locator.zoom,center:coordinates})}}},schoolDetail:function(infoId){var detail=$("#"+infoId+" .inf-detail");if(infoId.indexOf("inf-pop")==
0){var me=this;detail.slideToggle(function(){if($(".popup").height()>$("#map").height()){me.fullScreenDetail(infoId);detail.hide()}else me.popup.pan()})}else detail.slideToggle()},direct:function(fid){var me=this,feature=me.schoolSrc.getFeatureById(fid),to=feature.get("address"),name=feature.getName(),from=me.origin();if(me.isFullScreen())$("a.full-screen-close").click();$("body").pagecontainer("change",$("#dir-page"),{transition:"slideup"});if(me.lastDir!=from+"|"+to){var args={from:unescape(from),
to:unescape(to),facility:unescape(name)};me.lastDir=from+"|"+to;me.directions.directions(args)}},autoFilter:function(check){var ageFilters=this.filterControls[0];$.each(ageFilters.inputs,function(){this.prop("checked",false);this.checkboxradio("refresh")});check.prop("checked",true);check.checkboxradio("refresh");ageFilters.changed()},isFullScreen:function(){return $(window).width()<=495||$(window).height()<=495||$("#inf-full-screen").css("display")=="block"},fullScreenDetail:function(infoId){var fid=
infoId.replace(/inf-pop/,""),feature=this.schoolSrc.getFeatureById(fid),html=feature.html("inf-full-screen");$("#inf-full-screen div").html(html).trigger("create");$("#inf-full-screen").fadeIn()},origin:function(){var location=this.location||{};if(location.type=="geolocation"){var coordinates=proj4("EPSG:3857","EPSG:4326",location.coordinates);return[coordinates[1],coordinates[0]]}return location.name||""},zoomChange:function(event){if(this.mapLoaded){var me=this,res=me.view.getResolution();$.each([me.districtLyr,
me.subwayLineLyr,me.subwayStationLyr],function(_,lyr){if(!lyr.get("added")&&res>=lyr.getMinResolution()&&res<=lyr.getMaxResolution()){me.map.addLayer(lyr);if(lyr!==me.subwayLineLyr)new nyc.ol.FeatureTip(me.map,[{layer:lyr,labelFunction:me.getTip}]);lyr.set("added",true)}})}},filterDisplay:function(applicationPeriod){if(applicationPeriod.isActive()&&this.content.message("application_filter_btn"))$("#chk-apply").show();if(this.content.message("dynamic_filter_btn"))$("#chk-dynamic").show()},ready:function(){var me=
this;me.view.fit(nyc.ol.Basemap.EXTENT,me.map.getSize());me.listSchools();$("#tabs").tabs({active:1});$("#first-load").fadeOut(function(){me.qstrFid()})},qstrFid:function(){var fid=document.location.search.split("\x3d")[1];this.goToSchool(fid)},tabs:function(event){var target=$(event.currentTarget);$("#panel").css("z-index",target.attr("href")=="#map-tab"?999:1E3)},listSchools:function(location){var loc=location||this.location||{},features=this.schoolSrc.sort(loc.coordinates);$("#school-list").empty();
this.pager.reset(features);this.listNextPage();this.controls.removeFeatures("pka");this.controls.setFeatures({featureTypeName:"pka",features:features,nameField:"NAME",labelField:"search_label"})},isFiltered:function(){var filtered=this.schoolSrc.getFeatures().length!=this.schoolSrc.allFeatures.length;$('a[href\x3d"#filters-tab"]')[filtered?"addClass":"removeClass"]("filter-on")},listNextPage:function(){var container=$("#school-list");$.each(this.pager.next(),function(i,feature){var info=$(feature.html("inf-list"));
info.attr("role","listitem");if(i%2!=0)info.addClass("odd-row");$(container).append(info).trigger("create")});$("#btn-more")[$("div.inf-list.info").length==this.schoolSrc.getFeatures().length?"fadeOut":"fadeIn"]()},located:function(location){this.location=location;this.listSchools()},checkEntryUrl:function(){var ageFilters=this.filterControls[0];if(document.location.href.indexOf("el")>-1)this.autoFilter(ageFilters.inputs[1]);else if(document.location.href.indexOf("3k")>-1)this.autoFilter(ageFilters.inputs[0]);
else this.autoFilter(ageFilters.inputs[2])},checkEntryButton:function(event){var ageFilters=this.filterControls[0],target=event?event.target:{};if(target.nodeName=="SPAN")target=target.parentNode;if($(target).hasClass("el"))this.autoFilter(ageFilters.inputs[1]);else if($(target).hasClass("3k"))this.autoFilter(ageFilters.inputs[0]);else if($(target).hasClass("prek"))this.autoFilter(ageFilters.inputs[2])},bannerHtml:function(values){var title,click;values=values||[];if(values.indexOf("el")>-1&&values.indexOf("3k")==
-1&&values.indexOf("pk")==-1){title="Early Learn 3s Finder";click='document.location\x3d"../el";'}else if(values.indexOf("3k")>-1&&values.indexOf("pk")==-1){title="3-K Finder";click='document.location\x3d"../3k";'}if(!title){title="Pre-K Finder";click='document.location\x3d"../upk";'}$(".banner h1, .banner img").html(title).attr("title","NYC "+title).attr("onclick",click).attr("alt","NYC "+title)},filter:function(){var me=this,namedFilters={},filters=[];$.each(me.filterControls,function(_,control){$.each(control.val(),
function(__,choice){var filter=namedFilters[choice.name]||[];filter=filter.concat(choice.value.split(","));namedFilters[choice.name]=filter})});for(var name in namedFilters)filters.push({property:name,values:namedFilters[name]});me.bannerHtml(namedFilters.prek3);setTimeout(function(){me.schoolSrc.filter(filters);me.isFiltered();me.listSchools();me.clearLocation()},100)},clearPopup:function(){var id=$(".inf-pop").attr("id");if(id){var feature=this.schoolSrc.getFeatureById(id.replace(/inf-pop/,""));
if(!feature)this.popup.hide()}},clearLocation:function(){var location=this.location||{},id=location.data?location.data.LOCCODE:"";if(id){var feature=this.schoolSrc.getFeatureById(id);if(!feature)this.locationMgr.locator.source.clear()}this.clearPopup()},pageChanged:function(){if($("#panel").width()==$(window).width())$("#map-tab-btn a").trigger("click");$(".school-yr").html(this.content.message("school_year"));if(!this.mapLoaded){this.map.once("change:size",function(){$("#first-load").fadeOut()});
this.view.setZoom(12);this.mapLoaded=true}var div=$("#map");this.map.setSize([div.width(),div.height()]);this.map.render();this.form.reset();$(".banner h1")[$("body").pagecontainer("getActivePage").attr("id")=="dir-page"?"addClass":"removeClass"]("dir")},page:function(event){var target=$(event.currentTarget),page=target.data("page");if(!this.mapLoaded)$("#first-load").fadeIn();$("body").pagecontainer("change",page,{transition:"slideup"})},tap:function(event){this.mapClick({pixel:[event.offsetX,event.offsetY]})},
mapClick:function(event){var me=this,map=me.map,px=event.pixel;map.forEachFeatureAtPixel(px,function(feature,layer){var coords,html;if(feature.html){coords=feature.getCoordinates();html=feature.html("inf-pop")}if(coords){me.showPopup(coords,html,feature.getId());return true}})},showPopup:function(coordinates,html,fid){this.hideTips();this.popup.setOffset([0,-10]);this.popup.show({coordinates:coordinates,html:html});if($(".popup").height()>$("#map").height()){this.popup.hide();this.fullScreenDetail(fid)}},
getTip:function(){return{text:this.getName()}},hideTips:function(){$(".feature-tip").fadeOut()},resize:function(){if($("#panel").width()!=$(window).width()&&$("#map-tab-btn").hasClass("ui-tabs-active"))$("#schools-tab-btn a").trigger("click");if($(window).height()<$(window).width()&&$("body").pagecontainer("getActivePage").attr("id")=="dir-page")$("#dir-toggle a:last-of-type:not(.ui-btn-active)").trigger("click")}};var timeOffset=1E3*60*15;var cacheBust=Math.round((new Date).getTime()/timeOffset)*timeOffset;
function csvContentLoaded(csvContent){pka.messages.push(csvContent);$(document).ready(function(){var GEOCLIENT_URL="//maps.nyc.gov/geoclient/v1/search.json?app_key\x3d07368656C6C732062\x26app_id\x3dpre-k";var GOOGLE_URL="https://maps.googleapis.com/maps/api/js?client\x3dgme-newyorkcitydepartment\x26channel\x3dpka\x26sensor\x3dfalse\x26libraries\x3dvisualization";var lang=new nyc.Lang({target:"#lang",languages:pka.lookup.languages});lang.on(nyc.Lang.EventType.READY,function(){$("#first-load").fadeOut()});
new nyc.Share("#map");var map=new nyc.ol.Basemap({target:$("#map").get(0)});var applicationPeriod=new pka.ApplicationPeriod(csvContent.apply_start_date,csvContent.apply_end_date);var schoolContent=new nyc.Content(pka.messages);var schoolStyle=new pka.Style;var schoolSrc=new nyc.ol.source.FilteringAndSorting({loader:new nyc.ol.source.CsvPointFeatureLoader({url:"data/pka/pka.csv?"+cacheBust,projection:"EPSG:2263",xCol:"X",yCol:"Y"})},[{applicationPeriod:applicationPeriod},schoolContent,nyc.fieldAccess,
pka.fieldAccess,pka.htmlRenderer,pka.lookup],{nativeProjection:"EPSG:2263",projection:"EPSG:3857"});var schoolLyr=new ol.layer.Vector({source:schoolSrc,style:$.proxy(schoolStyle.school,schoolStyle),maxResolution:nyc.ol.TILE_GRID.getResolution(11),zIndex:400});map.addLayer(schoolLyr);var districtSrc=new nyc.ol.source.Decorating({url:"data/pka/school-district.json",format:new ol.format.TopoJSON},[{getName:function(){return"District "+this.get("NAME")}}]);var districtLyr=new ol.layer.Vector({source:districtSrc,
style:$.proxy(schoolStyle.district,schoolStyle),zIndex:1,maxResolution:nyc.ol.TILE_GRID.getResolution(10),opacity:.5});var subwayStyle=new ta.Style(ta.lookup);var subwayContent=new nyc.Content(ta.messages);var subwayLineSrc=new nyc.ol.source.Decorating({url:"data/ta/subway-line.json",format:new ol.format.TopoJSON},[subwayContent,ta.lookup,nyc.fieldAccess]);var subwayLineLyr=new ol.layer.Vector({source:subwayLineSrc,style:$.proxy(subwayStyle.line,subwayStyle),maxResolution:nyc.ol.TILE_GRID.getResolution(10),
zIndex:100,opacity:.6});var subwayStationSrc=new nyc.ol.source.Decorating({loader:new nyc.ol.source.CsvPointFeatureLoader({url:"data/ta/subway-station.csv",projection:"EPSG:2263",xCol:"X",yCol:"Y"})},[subwayContent,ta.lookup,nyc.fieldAccess,ta.fieldAccess,ta.htmlRenderer],{projection:"EPSG:3857"});var subwayStationLyr=new ol.layer.Vector({source:subwayStationSrc,style:$.proxy(subwayStyle.station,subwayStyle),maxResolution:nyc.ol.TILE_GRID.getResolution(10),zIndex:200});var filterControls=[new nyc.Check({target:"#chk-prek-3k",
title:"age group",expanded:true,choices:[{name:"prek3",value:"el-3k,el-3k-pk,3k,3k-pk",label:'3-K \x3cspan class\x3d"birth"\x3e(born '+(schoolContent.message("start_year")-3)+")\x3c/span\x3e",checked:true},{name:"prek3",value:"el,el-3k,el-3k-pk,el-pk",label:'early learn 3s \x3cspan class\x3d"birth"\x3e(born '+(schoolContent.message("start_year")-3)+")\x3c/span\x3e",checked:true},{name:"prek3",value:"el-3k-pk,el-pk,pk,3k-pk",label:'Pre-K \x3cspan class\x3d"birth"\x3e(born '+(schoolContent.message("start_year")-
4)+")\x3c/span\x3e",checked:true}]}),new nyc.Check({target:"#chk-dynamic",title:schoolContent.message("dynamic_filter_btn"),expanded:true,choices:[{name:"DYNAMIC",value:"1",label:schoolContent.message("dynamic_filter_btn")}]}),new nyc.Check({target:"#chk-apply",title:schoolContent.message("application_filter_btn"),expanded:true,choices:[{name:"can_apply",value:"1",label:schoolContent.message("application_filter_btn")}]}),new nyc.Check({target:"#chk-sch-type",title:"school type",expanded:true,choices:[{name:"TYPE",
value:"DOE",label:'\x3cimg alt\x3d"District School" src\x3d"img/DOE.png"\x3edistrict school',checked:true},{name:"TYPE",value:"NYCEEC",label:'\x3cimg alt\x3d"Early Ed Center" src\x3d"img/NYCEEC.png"\x3eearly ed center',checked:true},{name:"TYPE",value:"CHARTER",label:'\x3cimg alt\x3d"Charter School" src\x3d"img/CHARTER.png"\x3echarter school',checked:true},{name:"TYPE",value:"PKC",label:'\x3cimg alt\x3d"Pre-K Center" src\x3d"img/PKC.png"\x3ePre-K center',checked:true}]}),new nyc.Check({target:"#chk-day-len",
title:"day length",expanded:true,choices:[{name:"DAY_LENGTH",value:"1,2,5,7",label:"full day",checked:true},{name:"DAY_LENGTH",value:"3,6,7",label:"half day",checked:true},{name:"DAY_LENGTH",value:"4,5,6,7",label:"5-hour",checked:true}]}),new nyc.Check({target:"#chk-prog-feat",title:"program features",expanded:true,choices:[{name:"extend",value:"1",label:"extended hours"},{name:"INCOME_FLG",value:"1",label:"income eligibility"},{name:"lang",value:"1",label:"dual/enhanced language"}]})];var locationStyle=
new nyc.Style;nyc.app=new nyc.App(applicationPeriod,map,{school:schoolLyr,district:districtLyr,subwayStation:subwayStationLyr,subwayLine:subwayLineLyr},filterControls,pka.lookup,schoolContent,new nyc.LocationMgr({controls:new nyc.ol.control.ZoomSearch(map),locate:new nyc.ol.Locate(new nyc.Geoclient(GEOCLIENT_URL)),locator:new nyc.ol.Locator({map:map,style:$.proxy(locationStyle.location,locationStyle)})}),new nyc.Directions("#dir-map","#directions",GOOGLE_URL),new nyc.ol.Popup(map),new pka.Form(applicationPeriod,
schoolContent,pka.lookup.languages));new pka.Splash(applicationPeriod,pka.lookup,schoolContent,nyc.app)})}new nyc.CsvContent("data/pka/content.csv?"+cacheBust,csvContentLoaded);
//# sourceMappingURL=pka-min.sourcemap.json